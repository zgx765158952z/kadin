(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["components/content/session/Session"],{"06a9":function(t,n,e){"use strict";e.r(n);var o=e("4f9a"),s=e("6cf7");for(var i in s)"default"!==i&&function(t){e.d(n,t,function(){return s[t]})}(i);e("2684");var c,a=e("f0c5"),u=Object(a["a"])(s["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],c);n["default"]=u.exports},2684:function(t,n,e){"use strict";var o=e("c0d7"),s=e.n(o);s.a},"2b15":function(t,n,e){"use strict";(function(t,o){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var s=e("587d"),i=e("7429"),c=e("563c"),a=e("2f62");function u(t){for(var n=1;n<arguments.length;n++){var e=null!=arguments[n]?arguments[n]:{},o=Object.keys(e);"function"===typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(e).filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.forEach(function(n){r(t,n,e[n])})}return t}function r(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}var l=function(){return e.e("components/content/defmask/DefMask").then(e.bind(null,"15e1"))},f=function(){return e.e("components/content/loading-icon/LoadingIcon").then(e.bind(null,"aa5f"))},h={components:{DefMask:l,LoadingIcon:f},data:function(){return{msgContent:"",btmHeight1:0,btmHeight2:0,contentStyle1:"",contentStyle2:"",showKeyboard:!0,isFocus:!1,showTool:!1,adjust:!0,msgTips:!1,isListening:!1,speakTimer:null,speakCount:0,isSpeak:!1,speakingTitle:"按住 说话",showCancel:!1,cancelActive:!1,translateActive:!1,cancelInfo:{left1:0,right1:0,left2:0,right2:0,top:0,bottom:0},app:null,imgUrl:"",chatType:"",friendInfo:{},groupInfo:{},lastMsg:{},pageCount:1}},computed:u({getFriendInfo:function(){return function(t,n){for(var e=0;e<this.friendList.length;e++)for(var o=0;o<this.friendList[e].list.length;o++)if(this.friendList[e].list[o].friendAccount===n)return this.friendList[e].list[o][t]}},calcSpeakCount:function(){return this.speakCount<10?"0".concat(this.speakCount):this.speakCount}},(0,a.mapState)(["userInfo","friendList","currentChatList","currentChatTo"])),filters:{formatTime:function(t){return(0,s.formatTimeStamp)(t,"MM-dd hh:mm")}},watch:{},methods:u({},(0,a.mapMutations)(["setCurrentChatList","setCurrentChatTo"]),{sendMsg:function(){var n=this,e={fromUser:this.userInfo.user.userAccount,ope:"p2p"===this.chatType?0:1,toUser:this.lastMsg.target,type:0,msg:this.msgContent};(0,c.sendMsgRequest)(e).then(function(e){t("log",e," at components\\content\\session\\Session.vue:341"),200===e.status?2e3===e.data.code?(o.showToast({title:"发送成功",icon:"none"}),n.msgContent="",n.$nextTick(function(){n.$forceUpdate()})):o.showToast({title:"程序走丢了,请稍后重试",icon:"none"}):404===e.status?o.showToast({title:"网络走丢了,请稍后重试",icon:"none"}):o.showToast({title:"程序走丢了,请稍后重试",icon:"none"})}).catch(function(n){t("log",n," at components\\content\\session\\Session.vue:370")})},listenVoice:function(){this.isListening=!this.isListening},handleTips:function(){var t=this;o.showModal({title:"提示",content:"消息未发送,是否重新发送",success:function(n){n.confirm&&(t.msgTips=!1)}})},moveHandle:function(n){var e=this;n.touches[0].clientY<540?(t("log",n," at components\\content\\session\\Session.vue:396"),this.showCancel=!0):this.showCancel=!1,this.showCancel&&(0===this.cancelInfo.right2?this.$nextTick(function(){var n=o.createSelectorQuery().in(e);n.select(".cancel-item").boundingClientRect(function(n){e.cancelInfo.left1=n.left,e.cancelInfo.right1=n.right,e.cancelInfo.top=n.top,e.cancelInfo.bottom=n.bottom,t("log",e.cancelInfo," at components\\content\\session\\Session.vue:413")}).exec(),n.select(".translate-item").boundingClientRect(function(n){e.cancelInfo.left2=n.left,e.cancelInfo.right2=n.right,t("log",e.cancelInfo," at components\\content\\session\\Session.vue:420")}).exec()}):n.touches[0].clientY>this.cancelInfo.top&&n.touches[0].clientY<this.cancelInfo.bottom?n.touches[0].clientX>this.cancelInfo.left1&&n.touches[0].clientX<this.cancelInfo.right1?this.$nextTick(function(){e.cancelActive=!0}):n.touches[0].clientX>this.cancelInfo.left2&&n.touches[0].clientX<this.cancelInfo.right2?this.$nextTick(function(){e.translateActive=!0}):this.$nextTick(function(){e.cancelActive=!1,e.translateActive=!1}):this.$nextTick(function(){e.cancelActive=!1,e.translateActive=!1}))},showSpeaking:function(){var t=this;this.isSpeak=!0,this.speakingTitle="松开 结束",this.$refs.speakMask.isShowMask=!0,this.speakTimer=setInterval(function(){t.speakCount+=1},1e3),this.speakTimer},hideSpeaking:function(){this.cancelActive?t("log","取消语音"," at components\\content\\session\\Session.vue:468"):this.translateActive?t("log","将语音转成文字"," at components\\content\\session\\Session.vue:470"):t("log","发送语音"," at components\\content\\session\\Session.vue:472"),this.isSpeak=!1,this.speakingTitle="按住 说话",this.showCancel=!1,this.cancelActive=!1,this.translateActive=!1,clearInterval(this.speakTimer),this.speakCount=0,this.$refs.speakMask.isShowMask=!1},handleCancel:function(n){t("log","取消"," at components\\content\\session\\Session.vue:488"),t("log",n," at components\\content\\session\\Session.vue:489")},handleTranslate:function(n){t("log","转文字"," at components\\content\\session\\Session.vue:494"),t("log",n," at components\\content\\session\\Session.vue:495")},doSpeak:function(){var t=this;this.$nextTick(function(){t.showKeyboard=!1,t.showTool=!1,t.isFocus=!1})},doInput:function(){var t=this;this.$nextTick(function(){t.showKeyboard=!0,t.isFocus=!0})},handleInput:function(n){t("log",n," at components\\content\\session\\Session.vue:517")},updateFocus:function(){var t=this;this.showTool&&(this.showTool=!1),setTimeout(function(){t.$nextTick(function(){t.isFocus=!1,t.adjust=!1,setTimeout(function(){t.isFocus=!0,t.adjust=!0},80)})},80)},handleFocus:function(){},hideAll:function(){this.showTool&&this.$nextTick(function(){var t=this;setTimeout(function(){t.showTool=!1},200)}),this.isFocus&&this.$nextTick(function(){var t=this;setTimeout(function(){t.isFocus=!1},200)})},handleTool:function(){var t=this;this.showTool=!this.showTool,setTimeout(function(){if(0===t.btmHeight2){var n=o.createSelectorQuery().in(t);n.select(".session-btm").boundingClientRect(function(n){var e=n.height;t.contentStyle2="top: 0; right: 0; bottom: ".concat(e,"px; left: 0; "),t.btmHeight2=e}).exec()}},80)},getBtmHeight:function(){var n=this,e=o.createSelectorQuery().in(this);e.select(".session-btm").boundingClientRect(function(e){var o=e.height;n.contentStyle1="top: 0; right: 0; bottom: ".concat(o,"px; left: 0; "),t("log",o," at components\\content\\session\\Session.vue:598")}).exec()},getHistoryMsgsDone:function(n,e){t("log","获取p2p历史消息",e," at components\\content\\session\\Session.vue:603"),this.setCurrentChatList(e)},toGroupInfo:function(){o.navigateTo({url:"/components/content/session/sessionSon/GroupInfo"})},toChatFriendSetting:function(){o.navigateTo({url:"/components/content/session/sessionSon/ChatFriendSetting"})}}),onLoad:function(t){},created:function(){this.imgUrl=i.imgBaseUrl;var n=getApp(),e=o.getStorageSync("toSessionInfo");t("log","toSessionInfo:",e," at components\\content\\session\\Session.vue:629"),"p2p"===e.lastMsg.scene?(this.chatType="p2p",this.friendInfo=e.friendInfo):this.chatType="team",this.lastMsg=e.lastMsg,n.globalData.nim.getHistoryMsgs({scene:e.lastMsg.scene,limit:50,to:e.lastMsg.target,done:this.getHistoryMsgsDone})},mounted:function(){this.getBtmHeight()},onBackPress:function(){return!!this.showTool&&(this.showTool=!1,!0)},onPageScroll:function(t){var n=this;this.isFocus&&this.$nextTick(function(){n.isFocus=!1}),this.showTool&&this.$nextTick(function(){n.showTool=!1})},onNavigationBarButtonTap:function(t){0===t.index&&("p2p"===this.chatType?this.toChatFriendSetting():this.toGroupInfo())},onHide:function(){clearInterval(this.speakTimer)},onUnload:function(){this.setCurrentChatList([]),this.setCurrentChatTo("")}};n.default=h}).call(this,e("0de9")["default"],e("6e42")["default"])},"4f9a":function(t,n,e){"use strict";var o,s=function(){var t=this,n=t.$createElement,e=(t._self._c,t.__map(t.currentChatList.msgs,function(n,e){var o=t._f("formatTime")(n.time),s=t.getFriendInfo("friendRemarkName",n.from),i=t._f("formatTime")(n.time);return{$orig:t.__get_orig(n),f0:o,m0:s,f1:i}}));t.$mp.data=Object.assign({},{$root:{l0:e}})},i=[];e.d(n,"b",function(){return s}),e.d(n,"c",function(){return i}),e.d(n,"a",function(){return o})},"6cf7":function(t,n,e){"use strict";e.r(n);var o=e("2b15"),s=e.n(o);for(var i in o)"default"!==i&&function(t){e.d(n,t,function(){return o[t]})}(i);n["default"]=s.a},9464:function(t,n,e){"use strict";(function(t){e("8484"),e("921b");o(e("66fd"));var n=o(e("06a9"));function o(t){return t&&t.__esModule?t:{default:t}}t(n.default)}).call(this,e("6e42")["createPage"])},c0d7:function(t,n,e){}},[["9464","common/runtime","common/vendor"]]]);